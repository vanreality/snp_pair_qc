params {
    input_samplesheet         = null
    fasta                     = null
    fasta_index               = null
    known_sites_tsv           = null
    outdir                    = null
}

process {
    executor = 'slurm'

    publishDir = [
        path: { "${params.outdir}/${task.process.tokenize(':')[-1].toLowerCase()}" },
        mode: 'copy',
        saveAs: { filename -> filename.equals('versions.yml') ? null : filename }
    ]

    withName: 'BWAMEM2_INDEX' {
        container = "${baseDir}/images/bwa-mem2_htslib_samtools.sif"
        cpus      = 16
        memory    = 32.GB
        time      = 24.h
        queue     = 'cn-long'
    }

    withName: 'BWAMEM2_MEM' {
        container = "${baseDir}/images/bwa-mem2_htslib_samtools.sif"
        cpus      = 16
        memory    = 32.GB
        time      = 24.h
        queue     = 'cn-long'
    }

    withName: 'PICARD_MARKDUPLICATES' {
        container = "${baseDir}/images/picard_3.4.0.sif"
        cpus      = 8
        memory    = 16.GB
        time      = 24.h
        queue     = 'cn-long'
        ext.suffix= 'dedup.bam'
        ext.args  = '--REMOVE_DUPLICATES true --CREATE_INDEX true'
        publishDir = [ enabled: false ]
    }

    withName: 'SNP_PILEUP' {
        container = "${baseDir}/images/common_tools.sif"
        cpus      = 8
        memory    = 16.GB
        time      = 24.h
        queue     = 'cn-long'
    }

    withName: 'SNP_CORRELATION' {
        container = "${baseDir}/images/common_tools.sif"
        cpus      = 8
        memory    = 16.GB
        time      = 24.h
        queue     = 'cn-long'
    }
}

profiles {
    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        singularity.runOptions = "-B /lustre1,/lustre2,/appsnew"
    }
}

manifest {
    author = 'vanreality'
    name = 'snp_pair_qc'
    description = 'A pipeline for SNP pair quality control'
    version = 'dev1.0'
}